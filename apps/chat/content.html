<!DOCTYPE html>
<html>
<head>
    <title>C° Chat</title>
    <link rel="stylesheet" href="./apps/chat/style.css">
    <!-- Load chat UI -->
    <script type="module">
        import { ChatUI } from './apps/chat/front-scripts/renderer.js';
        // Initialize after DOM is ready
        window.addEventListener('DOMContentLoaded', () => {
            window.chatUI = new ChatUI();
            // Connect all buttons after initialization
            connectButtons();
        });

        function connectButtons() {
            // Connect start button
            document.querySelector('#login chat-button')
                .addEventListener('click', () => window.chatUI.start());

            // Connect channel button
            document.querySelector('#newChannel')
                .nextElementSibling
                .addEventListener('click', () => window.chatUI.joinChannel());

            // Connect peer button
            document.querySelector('#peerAddr')
                .nextElementSibling
                .addEventListener('click', () => window.chatUI.connectPeer());

            // Connect send button
            document.querySelector('#message')
                .nextElementSibling
                .addEventListener('click', () => window.chatUI.sendMessage());
        }
    </script>
</head>
<body>
    <div id="login">
        <h2>C° Chat</h2>
        <input type="text" id="nickname" placeholder="Enter nickname">
        <chat-button>Start</chat-button>
    </div>

    <div id="app" class="app">
        <div id="sidebar">
            <div class="logo">C°</div>
            <div id="status"></div>

            <div class="section">
                <h3>Channels</h3>
                <div id="channels"></div>
                <div style="margin-top: 10px;">
                    <input type="text" id="newChannel" placeholder="Channel name">
                    <chat-button>Join</chat-button>
                </div>
            </div>

            <div class="section">
                <h3>Peers</h3>
                <div id="peers"></div>
                <div style="margin-top: 10px;">
                    <input type="text" id="peerAddr" placeholder="Peer address">
                    <chat-button>Connect</chat-button>
                </div>
            </div>
        </div>

        <div id="main">
            <div id="messages"></div>
            <div class="controls">
                <input type="file" id="fileInput" style="display: none">
                <button id="shareButton">Share File</button>
                <input type="text" id="message" placeholder="Type a message...">
                <chat-button>Send</chat-button>
            </div>
        </div>
    </div>

    <script>
        // File handling setup
        document.getElementById('shareButton').addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });
        document.getElementById('fileInput').addEventListener('change', (e) => {
            window.chatUI.handleFileUpload(e);
        });
    </script>
</body>
</html>